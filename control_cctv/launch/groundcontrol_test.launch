<launch>
  <arg name="robot_name" default="dragonfly11"/>
  <arg name="uav_odom_topic" value="/vicon/$(arg robot_name)/odom"/>
  <arg name="payload_odom_topic" value="/vicon/pl11/odom"/>
  <arg name="nodelet_manager_name" default="nodelet_manager_control"/>
  <arg name="rviz" default="1"/>

	<!-- Master Sync Stuff -->
    <node pkg="master_discovery_fkie" type="master_discovery" name="master_discovery">
	    <param name="mcast_group" value="224.0.0.1" />
    </node>

    <node pkg="master_sync_fkie" type="master_sync" name="multimaster_client_sync">
      	<rosparam file="$(find control_cctv)/config/multimaster_params.yaml" />
    </node>

    <node pkg="mocap_vicon"
      type="mocap_vicon_node"
      name="vicon"
      output="screen">
      <param name="server_address" value="mocap"/>
      <param name="frame_rate" value="100"/>
      <param name="max_accel" value="7.5"/>
      <param name="publish_tf" value="true"/>
      <param name="fixed_frame_id" value="mocap"/>
      <rosparam param="model_list">
        ["dragonfly11", "pl11"]
      </rosparam>
    </node>

    <node pkg="viz_cctv"
      type="VizCCTV"
      name="VizCCTV"
      output="screen">
      <remap from="~payload_odom_topic" to="$(arg payload_odom_topic)"/>
      <remap from="~uav_odom_topic" to="$(arg uav_odom_topic)"/>
      <remap from="~cable_q_topic" to="/$(arg robot_name)/control_cctv/cable_q"/>
      <remap from="~cable_q_dot_topic" to="/$(arg robot_name)/control_cctv/cable_q_dot"/>
      <remap from="~cable_w_topic" to="/$(arg robot_name)/control_cctv/cable_w"/>
      <remap from="~payload_vel_topic" to="/$(arg robot_name)/control_cctv/payload_vel"/>
      <param name="fixed_frame_id" value="mocap"/>
      <rosparam file="$(find control_cctv)/config/cable_vision_params.yaml"/>
    </node>

    <node pkg="mesh_visualization"
      type="mesh_visualization"
      name="mesh_visualization"
      output="screen">
      <param name="mesh_resource" value="package://mesh_visualization/mesh/hummingbird.mesh"/>
      <remap from="~input" to="$(arg uav_odom_topic)"/>
    </node>

    <node pkg="rviz"
     type="rviz"
     name="rviz"
     args="-d $(find control_cctv)/config/rviz_config.rviz"
     if="$(arg rviz)"/>

</launch>
